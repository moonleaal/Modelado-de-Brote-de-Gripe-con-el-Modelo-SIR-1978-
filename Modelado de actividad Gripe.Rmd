---
title: "Clase"
author: "Montserrat Carrera Leal - Abigail Godoy Araujo"
date: "2025-10-06"
output:
  pdf_document:
    latex_engine: xelatex
geometry: margin=1in
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Modelado de Gripe con el Modelo SIR

## Contexto de la Actividad

El objetivo es modelar un **brote de gripe** ocurrido en 1978 en un internado del norte de Inglaterra, reportado en el *British Medical Journal*.

* **Periodo del brote:** Del 22 de enero al 4 de febrero.
* **Población Total (N):** 763 personas.
* **Personas Infectadas Totales:** 512.
* **Enfoque del Modelo:** Se utilizará el **Modelo SIR**.
* **Simplificación:** No se considerará la **tasa de mortalidad**, ya que no se tienen registros de muertes.

## Ecuaciones del Modelo SIR se van a utilizar

Dado que no se considera la mortalidad, las ecuaciones diferenciales a modelar en R simplifican las que fueron presentadas en la clase

| Compartimento | Ecuación simplificada | Descripción |
| :--- | :--- | :--- |
| **Susceptibles ($\frac{dS}{dt}$)** | $\frac{dS}{dt} = -\beta I\frac{S}{N}$ | Tasa de individuos que se infectan. |
| **Infectados ($\frac{dI}{dt}$)** | $\frac{dI}{dt} = \beta I\frac{S}{N} - \gamma I$ | Tasa de cambio de infectados (nuevas infecciones menos recuperaciones). |
| **Removidos ($\frac{dR}{dt}$)** | $\frac{dR}{dt} = \gamma I$ | Tasa de individuos que se recuperan o son removidos. |

## Determinación de Parámetros

Para la simulación, necesitamos los valores iniciales y los parámetros clave: la tasa de transmisión ($\beta$) y la tasa de recuperación ($\gamma$).

### **1. Tasa de Recuperación ($\gamma$)**

Se basa en el **tiempo de recuperación** promedio de una gripe, que se asume en **2 días**.

* **Fórmula:** $\gamma = \frac{1}{\text{Tiempo de Recuperación}}$

* **Valor:** $\gamma = \frac{1}{2} = 0.5$

### **2. Tasa de Transmisión ($\beta$)**

Se estima a partir de los datos iniciales de la epidemia

* **Población Inicial ($N$):** $N = 763$

* **Infectados Iniciales ($I(0)$):** Se asume que en el Día 0 solo una persona estaba oficialmente infectada para el inicio del modelo: $I(0) = 1$.

* **Susceptibles Iniciales ($S(0)$):** $S(0) = N - I(0) = 763 - 1 = 762$.

* **Cambio en Infectados ($I'(0)$):** Aproximado por la diferencia en los primeros dos días: $I'(0) \approx I(1) - I(0) = 3 - 1 = 2$

* **Fórmula de Aproximación:** $\beta \approx \frac{I'(0)}{S(0)I(0)}$

* **Cálculo:** $\beta \approx \frac{3-1}{762 \cdot 1} \approx 0.0026$.

## **Valores Iniciales y Parámetros Finales**

| Variable / Parámetro | Símbolo | Valor |
| :--- | :--- | :--- |
| **Población Total** | $N$ | 763 |
| **Susceptibles Iniciales** | $S(0)$ | 762 |
| **Infectados Iniciales** | $I(0)$ | 1 |
| **Removidos Iniciales** | $R(0)$ | 0 |
| **Tasa de Recuperación** | $\gamma$ | 0.5 |
| **Tasa de Transmisión** | $\beta$ | 0.0026 |

## **Modelo en R** 

```{r}
# Gripe del British Medical Jounal SIR
# 22 de enero al 4 de febrero 1978 (14)

library(deSolve)


ed.sol.gripe = function( t, state, parms)
{
  with(as.list(state),
       {
         dxdt = rep(0, length(state))
         dxdt[1] = -(beta*I*S)/N            # Suceptibles
         dxdt[2] = (beta*I*S)/N - gamma*I   # Infectados
         dxdt[3] = gamma*I                  # Recuperados
         return(list(dxdt))
       })
}

# Establecemos las condiciones iniciales

beta = 1.6       # Tasa de infección
gamma = 0.41     # Tasa de recuperación
N = 763           # Población total
t = seq(0,25,1)   # rango a graficar
S0 = N - 1        # Suponiendo que hay 1 infectado al inicio
I0 = 1
R0 = 0
init = c(S = S0, I = I0, R = R0)


# Resultado de la función ODE
res_irs_gripe = ode(
  y= init,
  times = t,
  func = ed.sol.gripe ,
  parms = NULL
)

# Resultado del primer modelo
head(res_irs_gripe)

# Rango en y
y_axis = c(0, 800)

# Graficamos la variable S (Suceptibles)

plot(
  res_irs_gripe[, "time"],
  res_irs_gripe[, "S"],
  type = "o",
  xlab = "Tiempo (días)",
  ylab = "Individuos",
  ylim = y_axis,
  col = "#89E95D",
  main = "Modelo SIR - Gripe contenida"
)

# La variable I (Infectados)
lines(
  res_irs_gripe[, "time"],
  res_irs_gripe[, "I"],
  type = "o",
  col = "#F399A7"
)

# La variable R (Recuperados)
lines(
  res_irs_gripe[, "time"],
  res_irs_gripe[, "R"],
  type = "o",
  col = "#cd2d11"
)

# Decoración
legend(
  "topright",
  legend = c("Suceptibles", "Infectados", "Recuperados"),
  col = c("#89E95D", "#F399A7", "#cd2d11"),
  lty = 1,
  pch = 1
)


# Comparación con datos reales
# Datos de la tabla
dias <- 1:14      # Creamos el rango de los 14 días
infectados_tabla <- c(3, 8, 28, 75, 221, 291, 255, 235, 190, 125, 70, 28, 12, 5)

# Graficamos los puntos sobre la curva de infectados
points(
  dias,
  infectados_tabla,
  col = "blue",
  pch = 19,
  cex = 1.2
)

# Agregar leyenda para los puntos
legend(
  "bottomright",
  legend = c("Datos observados"),
  col = c("blue"),
  pch = 19
)
```


### Datos reales registrados vs datos del modelo

Para la comparación, se incluyen los datos reales de infectados proporcionados en la actividad y se comparan con los obtenidos por el modelo. Donde los puntos azules que se observan en el gráfico representan los datos observados vs la gráfica que obtuvimos. 

Esta tabla compara los casos de infectados reportados en la tabla original (Datos Reales) con los valores simulados obtenidos del Modelo SIR utilizando los parámetros ajustados.

| Día | Infectados Reales | Infectados Simulados |
|:---:|:-----------------:|:--------------------:|
| 1   | 3                 | 3.27                 |
| 2   | 8                 | 10.57                |
| 3   | 28                | 32.88                |
| 4   | 75                | 91.50                |
| 5   | 221               | 196.85               |
| 6   | 291               | 286.77               |
| 7   | 255               | 295.45               |
| 8   | 235               | 248.87               |
| 9   | 190               | 190.17               |
| 10  | 125               | 138.67               |
| 11  | 70                | 98.71                |
| 12  | 28                | 69.33                |
| 13  | 12                | 48.32                |
| 14  | 5                 | 33.5                 |


### Interpretación de los resultados 
La interpretación de la gráfica se centra en dos análisis principales, inicialmente es la dinámica teórica del brote y el ajuste del modelo a los datos reales.

Por lo que esperamos que siga la dinámica general del modelo SIR, al observar la gráfica podemos confirmar que sige este comportamiento donde observamos estos puntos característicos: 

* **Suceptibles (S):** La curva se ve descender rápidamente lo que nos indica que el brote fue altamente contagioso entre las personas que se encontraban en esa institución. Y al final del gráfico esta curva se aplana por lo que este contagio dejó a pocos individuos suceptibles ante la gripe. 

* **Infectado(I)** La curva presenta el pico epidémico que va subiendo rápidamente y conforme pasan los días disminuye confirmando que la epidemia terminó una vez que el número de recuperados fue suficiente para reducir la infección.

* **Recuperados (R):** La curva aumenta y luego se estabiliza, el valor final de R representa la proporción total de la población (de 763) que fue infectada y removida (recuperada) al final del brote.






